## 需求：
id:: 67926601-73d9-48fd-8d69-8eeae4f6a68a
- > 可参考文章：语雀
	- 如何实现百万级排行榜功能
	- **基于Spring Event，实现同步转异步，解决定时任务扫表导致数据库连接池不够的问题**
	- **使用quartz定时任务实现支付单自动关单功能，并引入多线程+分段解决扫表延迟的问题**
	- https://zhuanlan.zhihu.com/p/477724438
- ## 可行方案：
  id:: c731394c-8a65-430e-a68e-5632d7e09dd0
	- 相同热度的活动，按照时间来排序：用得分加上（1-时间戳*${e^{-13}}$)
	  logseq.order-list-type:: number
	- 使用双缓存方案，通过版本号的形式进行更新
	  logseq.order-list-type:: number
- ## 问题：
	- DONE **如何保证数据输出时榜单不受影响**
		- 使用双缓存方案，通过版本号的形式进行更新
			- 数据库增加热度表，包含版本号和is_current列和状态，分为0和1，有效和无效即可
			- redis 中，每次更新时，先不动原始排行版，而是先把新数据写入new_version，在数据库更新完成之后，再rename，把new_version改为现在的版本号，改变版本号key，再删除原始版本
	- 如何保障状态更新后，排行榜的内容保持一致
		- 先解决[[用户操作/报名的并发]]问题，然后就在报名/取消之后进行一次判断，如果更新了状态，那么就更新排行榜中对应的那个活动，定时更新更新的大版本
			- 报名时也会再查一次状态，这个时候返回错误信息，提醒刷新就行了，redis应该已经更新了