- [[Daily Log]]
  collapsed:: true
	- 目标：
		- 活动状态流转
			- DONE  取消活动接口
			  project:: [[活动状态/状态流转更新]]
			  id:: 67972be7-9cf5-4ce6-a546-2546601b009a
		- 收藏
			- DONE  收藏数量的并发处理
			  project:: [[用户操作/收藏]]
			  id:: 67972be7-9edb-43f8-834f-ce4c6c6a6efb
		- DONE  游标分页的实现
		  project:: [[游标分页]]
		  id:: 67972be7-b7e8-48a5-96cd-69a8907eb0bf
		- DONE 未完成块怎么在dashbord中查询出来
		  id:: 67972be7-2744-4fb1-9e7c-b8d7a9a729b7
		- DONE 阿里云修好，ssh连上
		- DONE Mac屏幕伤眼睛吗？
		-
		- DONE  多条件筛选
		  project:: [[多条件筛选]]
	- Log:
		- 11:44-12:00 参与活动的service的检查写完
			- 总结：分布式锁一直实现错了，得给改过来，然后修改活动状态那里需要加分布式锁，然后注意失败的策略，直接拒绝重试就行
		- 12:00-13:43 午餐
		- 13:43-14:00 参与活动的service的检查写完
			- 总结：修好了分布式锁，加入到了状态更新里
		- 14:05-14:10 参与活动的service的检查写完
		- 14:10-14:35 取消活动的接口
			- 总结：修改了枚举类
		- 14:40-14:44 取消活动的接口
		- 14:45-15:00 到处收拾logseq
		- 15:00-15:25 收藏的方案写出来，开始写接口
			- 总结：接口注意检查
		- 15:30-15:55 收藏的添加、取消、查找接口完善
			- 总结：添加活动那边的计数和取消
			- 16:00-16:25 添加活动那边的计数和取消
				- 总结：搞定
		- 16:30-16:55 游标分页文档原理梳理
			- 总结：搞定
		- 17:00-17:25 分页游标的mysql方案写完
- ---
- 在参与活动时，进行[[活动状态/状态流转更新]]判断，此时需要用key为活动uuid的分布式锁，防止并发导致的额外参与
-
- [💋Uncleared] [[活动状态/状态流转更新]]
	- ## 需求：
		- 通知已参与的用户
		  logseq.order-list-type:: number
			- mq异步通知
			  logseq.order-list-type:: number
		- 参与表修改状态
		  logseq.order-list-type:: number
		- 活动表修改状态
		  logseq.order-list-type:: number
		- 防止取消后被并发修改改变状态
		  logseq.order-list-type:: number
			- 判断方法中，首先判断是取消或者过期就会直接返回
			  logseq.order-list-type:: number
			- 状态判断方法加分布式锁
			  logseq.order-list-type:: number
		- 幂等
		  logseq.order-list-type:: number
			- 通过uuid查询状态，不存在幂等问题，多次操作结果相同
			  logseq.order-list-type:: number
- ---
- [💋Uncleared] [[用户操作/收藏]]
	- ## 需求：
		- 活动表的收藏数同步
		  logseq.order-list-type:: number
			- 数据库原子操作加事务
			  logseq.order-list-type:: number
		- 分类查询
		  logseq.order-list-type:: number
		- 收藏的活动还剩最后一人时推送通知
		  logseq.order-list-type:: number
		- 收藏的幂等性
		  logseq.order-list-type:: number
			- 数据库唯一约束
			  logseq.order-list-type:: number
- ---
- Mac屏幕是不是有点伤眼睛啊，这几天眼睛红血丝就没消停过，不过也怪我天天熬夜侧着头看，能不能自律一点啊大哥#碎碎念
- [💋Uncleared] [[游标分页]]
	- ## 需求
		- 防止活动增加较快时，分页时上一页的内容大量出现在下一页
		- 活动总量不多，不需要跳转到指定页，每次都是从首项开始
		- 查询mysql中数据时的游标分页
			- 基于活动的自增id或者时间戳来做，取决于排序选项
				- 客户端传入末页uuid进行查询，id不会对外暴露
		- 查询redis热榜时是否需要分页？
			- 如果热榜限制了条数，那么就不需要，直接加载全部的热榜
				- 可以限制条数，超过条数之后再查数据库
	- ## 优点：
		- 基于上一页末尾进行下一页查找，不需要大量offset跳转，且不存在插入问题
	- ## 缺点：
		- 不能直接跳转到某一页，不适合网页端，适合无限滑动的移动端
- ---
- 累死了，br是怎做到天天搁那看的#碎碎念
-
	-